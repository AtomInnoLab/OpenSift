# Search backends for integration tests
# Usage: docker compose -f deployments/docker/docker-compose.test.yml up -d
#        make test-integration
#        docker compose -f deployments/docker/docker-compose.test.yml down -v

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.17.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - ES_JAVA_OPTS=-Xms256m -Xmx256m
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:9200/_cluster/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10

  opensearch:
    image: opensearchproject/opensearch:2.18.0
    ports:
      - "9201:9200"
    environment:
      - discovery.type=single-node
      - plugins.security.disabled=true
      - OPENSEARCH_JAVA_OPTS=-Xms256m -Xmx256m
      - OPENSEARCH_INITIAL_ADMIN_PASSWORD=OpenSift_Test_2024!
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:9200/_cluster/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10

  solr:
    image: solr:9.7
    ports:
      - "8983:8983"
    command: ["solr-precreate", "documents"]
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:8983/solr/documents/admin/ping || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10

  meilisearch:
    image: getmeili/meilisearch:v1.12
    ports:
      - "7700:7700"
    environment:
      - MEILI_ENV=development
      - MEILI_MASTER_KEY=test-master-key
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:7700/health || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 10
